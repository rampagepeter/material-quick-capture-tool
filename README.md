# 素材快捷投递工具 (Material Quick-Capture Tool)

一个高效的素材收集工具，包含桌面客户端和云端服务，支持快速捕获和投递文本、图片到飞书多维表格。

## 🚀 项目特色

- **🎯 智能捕获**：一键智能识别剪贴板内容类型（文本/图片）
- **⌨️ 快捷键自定义**：现代化的快捷键设置界面，支持一键捕获设置
- **🔄 实时同步**：桌面捕获内容实时同步到飞书多维表格
- **🎨 现代化界面**：简洁美观的用户界面设计
- **🔧 灵活配置**：支持服务器地址、访问密钥等全面配置

## 📁 项目结构

```
Material Quick-Capture Tool/
├── desktop-client/          # 桌面客户端 (已废弃，使用根目录版本)
├── cloud-relay-service/     # 云端中继服务 (Next.js)
├── src/                    # 桌面客户端源码 (Electron)
│   ├── main.js            # 主进程 - 完整版本
│   └── api.js             # API 通信模块
├── renderer/              # 渲染进程界面
│   ├── index.html         # 主窗口
│   ├── capture.html       # 捕获窗口
│   ├── styles.css         # 主窗口样式
│   ├── capture.css        # 捕获窗口样式
│   ├── main.js           # 主窗口逻辑
│   └── capture.js        # 捕获窗口逻辑
├── config/               # 配置文件目录
└── assets/              # 静态资源
```

## ✨ 核心功能

### 🎯 智能捕获
- **统一快捷键**：`Cmd+Shift+T` (macOS) / `Ctrl+Shift+T` (Windows/Linux)
- **自动识别**：智能检测剪贴板中的内容类型
- **一键操作**：无需记忆多个快捷键，一个快捷键搞定所有捕获

### 🔴 实时模式（新功能）
- **连续快捷键**：连续按两次智能捕获快捷键进入实时模式
- **自动上传**：监听剪贴板变化，检测到新内容自动上传
- **醒目提示**：屏幕右上角显示实时模式状态窗口
- **多种退出**：ESC键、快捷键、界面按钮、托盘菜单
- **适用场景**：会议记录、课堂笔记、连续素材收集

### ⌨️ 快捷键自定义
- **直观设置**：点击"修改"按钮直接按键设置
- **实时预览**：即时显示捕获到的快捷键组合
- **智能验证**：自动过滤系统保留键，确保快捷键有效
- **冲突避免**：智能管理快捷键注册，避免重复和冲突

### 📋 内容捕获
- **文本捕获**：支持各种文本内容，自动去除空白
- **图片捕获**：支持截图、复制的图片内容
- **内容预览**：提交前可预览和编辑内容
- **备注添加**：支持为每个素材添加个性化备注

## 🛠 技术栈

### 桌面客户端
- **Electron 27+**：跨平台桌面应用框架
- **Node.js 18+**：JavaScript 运行环境  
- **HTML5/CSS3/ES6**：现代Web技术栈

### 云端服务
- **Next.js 14+**：React 全栈框架
- **飞书开放API**：多维表格集成
- **Node.js**：服务端运行环境

## 📦 安装与使用

### 环境要求
- Node.js 18+ 
- npm 或 yarn
- macOS 10.14+ / Windows 10+ / Linux (Ubuntu 18.04+)

### 桌面客户端

```bash
# 克隆项目
git clone https://github.com/rampagepeter/material-quick-capture-tool.git
cd material-quick-capture-tool

# 安装依赖
npm install

# 开发模式运行
npm run dev

# 标准模式运行  
npm start

# 构建打包
npm run build
```

### 云端服务

```bash
# 进入云端服务目录
cd cloud-relay-service

# 安装依赖
npm install

# 开发模式运行
npm run dev

# 生产模式运行
npm start
```

## ⚙️ 配置说明

### 首次设置

1. **启动应用**：运行桌面客户端
2. **服务器配置**：
   - 服务器地址：`http://localhost:3001` (本地开发)
   - 访问密钥：设置安全密钥
   - 提交者姓名：您的标识名称

3. **快捷键设置**：
   - 点击"修改"按钮
   - 按下想要的快捷键组合
   - 保存设置

4. **测试连接**：点击"测试连接"验证配置

### 云端服务配置

在 `cloud-relay-service/.env.local` 中配置：

```bash
# 飞书应用配置
FEISHU_APP_ID=your_app_id
FEISHU_APP_SECRET=your_app_secret
FEISHU_APP_TOKEN=your_app_token
FEISHU_TABLE_ID=your_table_id

# 安全配置
SECRET_KEY=your_secret_key
```

## 🎮 使用指南

### 日常操作

1. **复制内容**：复制文本或截图到剪贴板
2. **快捷捕获**：按 `Cmd+Shift+T` 启动智能捕获
3. **自动识别**：系统自动识别内容类型并打开对应窗口
4. **添加备注**：可选添加备注信息
5. **一键提交**：点击提交完成投递

### 托盘功能

- **最小化运行**：应用关闭后在托盘中继续运行
- **快速访问**：右键托盘图标快速访问功能
- **智能捕获**：托盘菜单中直接使用智能捕获

## 🔧 开发说明

### 项目特点

- **双文件结构**：项目包含简化版和完整版main.js，当前使用完整版
- **智能快捷键管理**：避免重复注册，精确注销旧快捷键
- **现代化配置**：JSON配置文件，支持热重载
- **API客户端**：模块化的云端通信接口

### 已完成功能

- [x] 项目基础架构
- [x] 桌面客户端完整功能
- [x] 智能捕获系统
- [x] 快捷键自定义界面
- [x] 云端中继服务
- [x] 飞书API集成
- [x] 全流程功能验证
- [x] 连接配置优化
- [x] 快捷键冲突解决
- [x] 实时模式功能
- [x] 配置导入导出
- [x] 团队协作支持

### 技术亮点

1. **智能内容识别**：优先检测图片，其次检测文本
2. **快捷键格式统一**：使用Electron标准格式避免冲突
3. **现代化交互**：按键捕获式快捷键设置
4. **稳定性保障**：完善的错误处理和状态管理
5. **实时模式**：连续按键检测和剪贴板监听
6. **团队协作**：配置文件导入导出机制

## 🐛 问题排查

### 常见问题

**Q: 快捷键不生效？**
A: 检查是否与系统快捷键冲突，尝试重新设置快捷键

**Q: 实时模式无法启动？**
A: 确保已配置表格且网络连接正常，检查飞书应用权限

**Q: 连续按快捷键没反应？**
A: 确认按键间隔在500毫秒内，或使用界面按钮启动实时模式

**Q: 连接云端服务失败？**  
A: 确认云端服务已启动在3001端口，检查网络连接

**Q: 剪贴板内容无法识别？**
A: 确保复制了有效的文本或图片内容

## 📄 开发文档

详细的开发文档请参考：
- [开发文档](./素材快捷投递工具%20(Material%20Quick-Capture%20Tool)%20-%20开发文档.md)
- [开发进度](./开发进度-TodoList.md)
- [实时模式功能说明](./docs/实时模式功能说明.md)

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## 📝 版本历史

### v1.1.0 (2025-01-04)
- ✅ 新增实时模式功能
- ✅ 支持连续快捷键启动实时模式
- ✅ 醒目的实时模式状态提示窗口
- ✅ 自动剪贴板监听和上传
- ✅ 多种实时模式退出方式
- ✅ 完善的配置导入导出功能
- ✅ 团队协作场景优化

### v1.0.0 (2024-12-30)
- ✅ 智能捕获功能
- ✅ 快捷键自定义
- ✅ 云端服务集成
- ✅ 飞书多维表格同步
- ✅ 现代化用户界面

## 📜 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 👥 作者

项目开发：AI Assistant & 用户协作开发

---

> 💡 **提示**：这是一个持续改进的项目，如有建议或问题，欢迎提出Issue或Pull Request！ 

## 主要功能

- ✨ **智能捕获**：自动识别剪贴板内容类型
- 🔴 **实时模式**：连续素材收集，自动监听剪贴板变化
- 📝 **文本提交**：快速提交文本内容到指定字段
- 🖼️ **图片上传**：支持图片上传到附件字段
- ⚡ **快捷键操作**：全局快捷键快速调用
- 🔧 **灵活配置**：支持多表格配置和字段映射
- 📤 **配置管理**：支持配置导入导出，方便团队使用

## 快速开始

### 团队成员使用（推荐）

如果您是团队成员，管理员已经配置好了应用，您只需要：

1. **获取配置文件**：从管理员处获取配置文件（`.json`格式）
2. **导入配置**：
   - 打开应用，进入"设置"标签页
   - 点击"导入配置"按钮
   - 选择配置文件并确认导入
3. **开始使用**：使用快捷键 `Ctrl+Shift+T`（Windows）或 `Cmd+Shift+T`（Mac）开始捕获素材

### 管理员配置（首次设置）

如果您需要从头配置应用，请按照以下步骤：

#### 1. 飞书应用配置

1. 登录 [飞书开放平台](https://open.feishu.cn/app)
2. 创建或选择您的应用
3. 获取 App ID 和 App Secret
4. 在应用中填入这些信息

#### 2. 权限配置

**⚠️ 重要：为了正常使用图片上传功能，必须配置以下权限：**

1. 打开 [飞书开放平台](https://open.feishu.cn/app)
2. 进入您的应用管理页面
3. 点击左侧菜单 "权限管理" → "应用权限"
4. 搜索并添加以下权限：
   - `bitable:app` - 多维表格应用权限
   - `drive:file:upload` - 文件上传权限
5. 点击 "发布版本" 使权限生效

#### 3. 表格配置

1. 在"表格管理"标签页中添加表格配置
2. 可以通过表格链接或手动输入 App Token 和 Table ID
3. 配置字段映射，指定文本、图片、备注等字段
4. 测试配置确保正常工作

#### 4. 导出配置

配置完成后，在"设置"标签页中：
1. 点击"导出配置"按钮
2. 保存配置文件
3. 将配置文件分享给团队成员

## 使用说明

### 智能捕获
- 复制任何内容后按快捷键
- 自动识别文本或图片类型
- 打开对应的提交窗口

### 快捷键
- 默认：`Ctrl+Shift+T`（Windows）/ `Cmd+Shift+T`（Mac）
- 可在"设置"中自定义

### 字段映射
- **文本字段**：存储文本内容
- **图片字段**：存储图片附件
- **备注字段**：存储额外说明
- **提交者字段**：记录提交人信息
- **时间字段**：记录提交时间

## 技术信息

- **基础技术**：Electron + HTML5 + CSS3 + JavaScript
- **API集成**：飞书开放API
- **支持平台**：Windows、macOS、Linux

## 故障排除

### 常见问题

1. **连接测试失败**
   - 检查 App ID 和 App Secret 是否正确
   - 确认网络连接正常
   - 验证飞书应用是否启用

2. **图片上传失败**
   - 确认已添加 `drive:file:upload` 权限
   - 检查权限是否已发布生效
   - 尝试重新测试连接

3. **字段映射错误**
   - 确认字段名称与飞书表格中的字段名称完全一致
   - 重新读取字段信息
   - 检查字段类型是否匹配

4. **快捷键不响应**
   - 检查快捷键是否与其他应用冲突
   - 尝试重新设置快捷键
   - 确认应用在后台运行

### 错误代码说明

- **99991672**：权限不足，需要添加相应的应用权限
- **1254045**：字段名称未找到，检查字段映射配置
- **1061002**：参数错误，检查API调用参数
- **1061044**：父节点不存在，检查表格配置

## 版本信息

当前版本：1.0.0

## 支持

如遇问题，请联系管理员或查看飞书开放平台文档。 